import{features as T}from"/Users/adam/Code/kokomoBay/dist/tests/testerantoFeatures.test.js";import{assert as m}from"chai";import{Testeranto as l}from"testeranto";var S=(o,r,e)=>l(e,r,o,{ports:1},{beforeEach:async function(t,s,n){let a=t();return await a.listen(n.ports[0]),a},andWhen:async function(t,s,n){let[a,i]=s(t);return await(await fetch(`http://localhost:${n.ports[0]}/${a}`,{method:"POST",body:i})).text()},butThen:async function(t,s,n){let[a,i]=s({}),p=await(await fetch(`http://localhost:${n.ports[0]}/${a}`)).text();return m.equal(p,i),p},afterEach:function(t,s){return new Promise(n=>{t.close(()=>{n(!0)})})}});import c from"http";var h=()=>{let o="some great status",r=0;return c.createServer(function(e,t){if(e.method==="GET")if(e.url==="/get_status"){t.write(o),t.end();return}else if(e.url==="/get_number"){t.write(r.toString()),t.end();return}else{t.write("<p>error 404<p>"),t.end();return}else if(e.method==="POST"){let s="";e.on("data",function(n){s+=n}),e.on("end",function(){if(e.url==="/put_status"){o=s.toString(),t.write("aok"),t.end();return}else if(e.url==="/put_number"){r=r+parseInt(s),t.write(r.toString()),t.end();return}else{t.write("<p>error 404<p>"),t.end();return}})}})};var u=T.hello,A=S({Suites:{Default:"some default Suite"},Givens:{AnEmptyState:()=>({})},Whens:{PostToStatus:o=>["put_status",o],PostToAdd:o=>["put_number",o.toString()]},Thens:{TheStatusIs:o=>()=>["get_status",o],TheNumberIs:o=>()=>["get_number",o]},Checks:{AnEmptyState:()=>({})}},(o,r,e,t,s)=>[o.Default("Testing the Node server with fetch",[r.AnEmptyState([u],[],[t.TheStatusIs("some great status")]),r.AnEmptyState([u],[e.PostToStatus("hello")],[t.TheStatusIs("hello")]),r.AnEmptyState([u],[e.PostToStatus("hello"),e.PostToStatus("aloha")],[t.TheStatusIs("aloha")]),r.AnEmptyState([u],[],[t.TheNumberIs(0)]),r.AnEmptyState([u],[e.PostToAdd(1),e.PostToAdd(2)],[t.TheNumberIs(3)]),r.AnEmptyState([u],[e.PostToStatus("aloha"),e.PostToAdd(4),e.PostToStatus("hello"),e.PostToAdd(3)],[t.TheStatusIs("hello"),t.TheNumberIs(7)])],[])],h);export{A as ServerHttpTesteranto};
