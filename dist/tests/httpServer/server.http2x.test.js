import{features as g}from"/Users/adam/Code/kokomoBay/dist/tests/testerantoFeatures.test.js";import{assert as c}from"chai";import{Testeranto as T}from"testeranto";var S=(e,s,n)=>T(n,s,e,{ports:2},{beforeEach:async function(t,r,o){let a=t();await a.listen(o.ports[0]);let u=t();return await u.listen(o.ports[1]),{serverA:a,serverB:u}},afterEach:function({serverA:t,serverB:r},o){return new Promise(a=>{t.close(()=>{r.close(()=>{a(!0)})})})},andWhen:async function(t,r,o){let[a,u,i]=r(t);return await(await fetch(`http://localhost:${o.ports[i]}/${a}`,{method:"POST",body:u})).text()},butThen:async function(t,r,o){let[a,u,i]=r({}),p=await(await fetch(`http://localhost:${o.ports[i]}/${a}`)).text();return c.equal(p,u),p}});import l from"http";var h=()=>{let e="some great status",s=0;return l.createServer(function(n,t){if(n.method==="GET")if(n.url==="/get_status"){t.write(e),t.end();return}else if(n.url==="/get_number"){t.write(s.toString()),t.end();return}else{t.write("<p>error 404<p>"),t.end();return}else if(n.method==="POST"){let r="";n.on("data",function(o){r+=o}),n.on("end",function(){if(n.url==="/put_status"){e=r.toString(),t.write("aok"),t.end();return}else if(n.url==="/put_number"){s=s+parseInt(r),t.write(s.toString()),t.end();return}else{t.write("<p>error 404<p>"),t.end();return}})}})};var m=g.hello,v=S({Suites:{Default:"some default Suite"},Givens:{AnEmptyState:()=>({})},Whens:{PostToStatusA:e=>["put_status",e,0],PostToAddA:e=>["put_number",e.toString(),0],PostToStatusB:e=>["put_status",e,1],PostToAddB:e=>["put_number",e.toString(),1]},Thens:{TheStatusIsA:e=>()=>["get_status",e,0],TheNumberIsA:e=>()=>["get_number",e,0],TheStatusIsB:e=>()=>["get_status",e,1],TheNumberIsB:e=>()=>["get_number",e,1]},Checks:{AnEmptyState:()=>({})}},(e,s,n,t,r)=>[e.Default("Testing the Node server with fetch * 2 ports",[s.AnEmptyState([m],[],[t.TheStatusIsA("some great status")]),s.AnEmptyState([m],[n.PostToStatusA("gutentag"),n.PostToStatusB("buenos dias")],[t.TheStatusIsA("gutentag"),t.TheStatusIsB("buenos dias")])],[])],h);export{v as ServerHttp2xTesteranto};
