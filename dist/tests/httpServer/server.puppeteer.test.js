import{features as d}from"/Users/adam/Code/kokomoBay/dist/tests/testerantoFeatures.test.js";import m from"puppeteer";import{assert as l}from"chai";import{Testeranto as c}from"testeranto";var S=(r,o,e)=>c(e,o,r,{ports:1},{beforeEach:function(t,s,n){return new Promise(a=>{m.launch({headless:!0,executablePath:"/Applications/Google Chrome.app/Contents/MacOS/Google Chrome"}).then(p=>{let u=t();a({server:u.listen(n.ports[0]),browser:p})})})},andWhen:async function(t,s,n){let[a,p]=s(t);return await(await fetch(`http://localhost:${n.ports[0]}/${a}`,{method:"POST",body:p})).text()},butThen:async function(t,s,n){let[a,p]=s(t),u=await(await fetch(`http://localhost:${n.ports[0]}/${a}`)).text();return l.equal(u,p),u},afterEach:function(t,s){return new Promise(n=>{t.browser.close(),t.server.close(()=>{n()})})}});import T from"http";var h=()=>{let r="some great status",o=0;return T.createServer(function(e,t){if(e.method==="GET")if(e.url==="/get_status"){t.write(r),t.end();return}else if(e.url==="/get_number"){t.write(o.toString()),t.end();return}else{t.write("<p>error 404<p>"),t.end();return}else if(e.method==="POST"){let s="";e.on("data",function(n){s+=n}),e.on("end",function(){if(e.url==="/put_status"){r=s.toString(),t.write("aok"),t.end();return}else if(e.url==="/put_number"){o=o+parseInt(s),t.write(o.toString()),t.end();return}else{t.write("<p>error 404<p>"),t.end();return}})}})};var i=d.hello,_=S({Suites:{Default:"some default Suite"},Givens:{AnEmptyState:()=>({})},Whens:{PostToStatus:r=>["put_status",r],PostToAdd:r=>["put_number",r.toString()]},Thens:{TheStatusIs:r=>o=>["get_status",r],TheNumberIs:r=>o=>["get_number",r]},Checks:{AnEmptyState:()=>({})}},(r,o,e,t,s)=>[r.Default("Testing the Server with Puppeteer",[o.AnEmptyState([],[],[t.TheStatusIs("some great status")]),o.AnEmptyState([],[e.PostToStatus("goodbye")],[t.TheStatusIs("goodbye")]),o.AnEmptyState([i],[e.PostToStatus("hello"),e.PostToStatus("aloha")],[t.TheStatusIs("aloha")]),o.AnEmptyState([],[],[t.TheNumberIs(0)]),o.AnEmptyState([i],[e.PostToAdd(1),e.PostToAdd(2)],[t.TheNumberIs(3)]),o.AnEmptyState([i],[e.PostToStatus("aloha"),e.PostToAdd(4),e.PostToStatus("hello"),e.PostToAdd(3)],[t.TheStatusIs("hello"),t.TheNumberIs(7)])],[])],h);export{_ as ServerHttpPuppeteerTesteranto};
